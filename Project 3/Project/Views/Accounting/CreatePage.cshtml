<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

@model Project.Models.Bill

@{
    ViewData["Title"] = "Create";
}

<h2>Create</h2>

<form asp-action="Create" method="post">
    <div class="form-group">
        <label asp-for="InvoiceNumber" class="control-label"></label>
        <input asp-for="InvoiceNumber" class="form-control" />
        <span asp-validation-for="InvoiceNumber" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="InvoiceDate" class="control-label"></label>
        <input asp-for="InvoiceDate" class="form-control" />
        <span asp-validation-for="InvoiceDate" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Currency" class="control-label"></label>
        <input asp-for="Currency" class="form-control" />
        <span asp-validation-for="Currency" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="CustomerFullName" class="control-label"></label>
        <input asp-for="CustomerFullName" class="form-control" />
        <span asp-validation-for="CustomerFullName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="ContactNumber" class="control-label"></label>
        <input asp-for="ContactNumber" class="form-control" />
        <span asp-validation-for="ContactNumber" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Date" class="control-label"></label>
        <input asp-for="Date" class="form-control" />
        <span asp-validation-for="Date" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="DeliveryDate" class="control-label"></label>
        <input asp-for="DeliveryDate" class="form-control" type="date"/>
        <span asp-validation-for="DeliveryDate" class="text-danger"></span>
    </div>

    <!-- Signature Canvas -->
        <div>
            <canvas id="signatureCanvas" width="100" height="50" style="border:1px solid black"></canvas>
        </div>
        <!-- Hidden input for Signature Data -->
    <input type="hidden" asp-for="SignatureString" id="signatureInput" />
    
    <div class="form-group">
        <input type="submit" value="Create" class="btn btn-primary" />
    </div>
    
    
    <script>
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
            }
        });
        
        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
            // When the drawing is done, save the signature as data URL
            const dataURL = canvas.toDataURL();
            console.log("dataURL:" + dataURL);
            //const compressedData = LZString.compressToEncodedURIComponent(dataURL);
            document.getElementById('signatureInput').value = dataURL; // Set the value in hidden input
        });
    </script>

</form>